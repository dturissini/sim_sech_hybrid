mkdir -p /work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows/plots
mkdir -p /work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows/logs

cd /work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows

sbatch sech_into_ssh.sbatch



################
#debug


#prep
sqlite3 /work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows/debug.db
attach database '/work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows/ssh_d_win.db' as s;

create table sample_species as select * from s.sample_species;
create index idx_ss_sid on sample_species(sample_id);

create table sample_pop_link as select * from s.sample_pop_link;
create index idx_spl_pop on sample_pop_link(pop);
create index idx_spl_sample_id on sample_pop_link(sample_id);

create table d_stat_win_50000_sim_ssh_sech_mel as select * from s.d_stat_win_50000_sim_ssh_sech_mel;
create index idx_d_swe on d_stat_win_50000_sim_ssh_sech_mel(start,end);
create index idx_d_see on d_stat_win_50000_sim_ssh_sech_mel(end);


create table outlier_d_plus_win_sites_50000_sim_ssh_sech_mel as select * from s.outlier_d_plus_win_sites_50000_sim_ssh_sech_mel;

create index idx_odwps5_pos_50000d_plus on outlier_d_plus_win_sites_50000_sim_ssh_sech_mel(pos);
create index idx_odwps5_win_id_50000d_plus on outlier_d_plus_win_sites_50000_sim_ssh_sech_mel(win_id);
create index idx_odwps5_pop_50000d_plus on outlier_d_plus_win_sites_50000_sim_ssh_sech_mel(pop);


python3 /work/users/d/t/dturissi/drosophila/ssh/introgression/scripts/get_outlier_win_alleles.py 50000 \
                                                                                                 sech \
                                                                                                 d_plus \
                                                                                                 sim_ssh_sech_mel \
                                                                                                 /work/users/d/t/dturissi/drosophila/ssh/introgression/sim_sech_outgroup_mel \
                                                                                                 /work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows/debug.db


sqlite3 /work/users/d/t/dturissi/drosophila/ssh/introgression/d_stats/windows/debug.db
attach database 'ssh_d_win_old.db' as o;

select count(*), sum(case when n.num_der_alleles != o.num_der_alleles then 1 else 0 end)
from outlier_d_plus_win_alleles_sech_50000_sim_ssh_sech_mel n, o.outlier_d_plus_win_alleles_sech_50000_sim_ssh_sech_mel o
where n.chrom = o.chrom
and n.pos = o.pos
and n.sample_id = o.sample_id;
446292|0



sbatch debug_vcf_allele_diffs.sbatch
sacct -j 10044527

Rscript debug_vcf_avg_depths.R

#################      
